import Vue from 'vue';
import component from 'ee/security_dashboard/components/vulnerability_chart_buttons.vue';
import { DAYS } from 'ee/security_dashboard/store/modules/vulnerabilities/constants';
import { shallowMount } from '@vue/test-utils';
import createStore from 'ee/security_dashboard/store';
import { resetStore } from '../helpers';

describe('Vulnerability Chart Buttons', () => {
  const Component = Vue.extend(component);
  const store = createStore();

  let wrapper;

  afterEach(() => {
    wrapper.destroy();
    resetStore(store);
  });

  it('should render with 90 days selected by default', () => {
    wrapper = shallowMount(Component, { store });

    const activeButton = wrapper.find('[title="Show Last 90 Days"].active');

    expect(activeButton.attributes('title')).toMatch('Show Last 90 Days');
  });

  it('should render with 90 days selected', () => {
    store.dispatch('vulnerabilities/setVulnerabilitiesHistoryDayRange', DAYS.NINETY);
    wrapper = shallowMount(Component, { store });

    const activeButton = wrapper.find('[title="Show Last 90 Days"].active');

    expect(activeButton.attributes('title')).toMatch('Show Last 90 Days');
  });

  it('should render with 60 days selected', () => {
    store.dispatch('vulnerabilities/setVulnerabilitiesHistoryDayRange', DAYS.SIXTY);
    wrapper = shallowMount(Component, { store });

    const activeButton = wrapper.find('[title="Show Last 60 Days"].active');

    expect(activeButton.attributes('title')).toMatch('Show Last 60 Days');
  });

  it('should render with 30 days selected', () => {
    store.dispatch('vulnerabilities/setVulnerabilitiesHistoryDayRange', DAYS.THIRTY);
    wrapper = shallowMount(Component, { store });

    const activeButton = wrapper.find('[title="Show Last 30 Days"].active');

    expect(activeButton.attributes('title')).toMatch('Show Last 30 Days');
  });
});
